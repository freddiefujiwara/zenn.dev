---
title: "è©±é¡Œæ²¸é¨°ãƒãƒƒãƒˆã«å¯¾ã—ã¦ Property based testing ã‚’è©¦ã—ã¦ã¿ã‚‹ (2)çµ¦æ¹¯(æ°´)ã•ã›ã‚‹"
emoji: "ğŸ¦”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["property-based-testing","fast-check","è©±é¡Œæ²¸é¨°ãƒãƒƒãƒˆ","ãƒ†ã‚¹ãƒˆ"]
published: false
---

#ã¯ã˜ã‚ã«
[è©±é¡Œæ²¸é¨°ãƒãƒƒãƒˆã«å¯¾ã—ã¦ Property based testing ã‚’è©¦ã—ã¦ã¿ã‚‹ (1)è“‹ã®é–‹ã‘é–‰ã‚ã€æ°´ã‚’å……å¡«ã•ã›ã‚‹](https://qiita.com/freddiefujiwara/items/5f8eaf834d2a24afdee1)ã«å¼•ãç¶šã
[fast-check](https://github.com/dubzzz/fast-check)ã‚’ä½¿ã£ã¦Property based testingã‚’è©¦ã—ã¦ã„ã¾ã™ã€‚
é¡Œæã¨ã—ã¦
[ãƒ†ã‚¹ãƒˆè¨­è¨ˆã‚³ãƒ³ãƒ†ã‚¹ãƒˆU-30ã‚¯ãƒ©ã‚¹](http://aster.or.jp/business/contest/rulebooku30.html)ã§ãƒ†ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã«æŒ‡å®šã•ã‚Œã¦ã„ã‚‹
[ã€Œè©±é¡Œæ²¸é¨°ãƒãƒƒãƒˆè¦æ±‚ä»•æ§˜æ›¸ (GOMAâ€1015å‹) ç¬¬ï¼—ç‰ˆ](http://www.sessame.jp/workinggroup/WorkingGroup2/POT_Specification.htm)ã«ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸ.


#æº–å‚™
[ã“ã¡ã‚‰](https://github.com/freddiefujiwara/goma-1015/blob/feature/pour/__tests__/lib/index.spec.ts)ã«ä»Šå›å®Ÿè£…ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’é…ç½®ã—ã¦ã¿ã¾ã—ãŸã€‚
Nodejsã®ç’°å¢ƒãŒæ‰‹å…ƒã«ã‚ã‚Œã°ã€è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
git clone https://github.com/freddiefujiwara/goma-1015.git
cd goma-1015
npm i
npm test
```
#æ—©é€Ÿçµ¦æ¹¯ã«å¯¾ã—ã¦Property based testingã—ã¦ã¿ã¾ã—ã‚‡ã†
##çµ¦æ¹¯(æ°´)ã•ã›ã‚‹

æ¬¡ã«ã€ãƒãƒƒãƒˆã‹ã‚‰ä¸­ã«å…¥ã£ã¦ã„ã‚‹æ°´ã‚’çµ¦æ°´ã—ã¦ã¿ã¾ã—ã‚‡ã†
ãƒœãƒƒãƒˆã«äº‹å‰ã«ã‚³ãƒ³ã‚»ãƒ³ãƒˆã«åˆºã™plugInã¨å¤–ã™plugOutã¨pour(çµ¦æ°´ãƒœã‚¿ãƒ³)ã¨ã„ã†æ©Ÿèƒ½ã‚’ãã‚Œãã‚Œè¿½åŠ ã—ã¦ãŠãã¾ã—ã‚‡ã†
[è¦æ±‚ä»•æ§˜æ›¸](http://www.sessame.jp/workinggroup/WorkingGroup2/POT_Specification_v7.PDF)ã«ã¯æ›¸ã„ã¦ãªã„ã§ã™ãŒä¸‹è¨˜ã¨ã—ã¾ã™

- è“‹ãŒé–‰ã¾ã£ã¦ã„ãªã„ã¨ã€çµ¦æ°´ã•ã‚Œãªã„ (*this is openã®ä¾‹å¤–ãŒç™ºç”Ÿ)
- ã‚³ãƒ³ã‚»ãƒ³ãƒˆã«åˆºã•ã£ã¦ãªã„ã¨(Plug In)ã€çµ¦æ°´ã•ã‚Œãªã„ (*plug should be connectedã®ä¾‹å¤–ãŒç™ºç”Ÿ)
- pourãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ãŸç§’æ•°ã ã‘çµ¦æ°´ã•ã‚Œã‚‹(10 ml/sec)
- ç©ºã®çŠ¶æ…‹ã§pourãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¦ã‚‚æ°´ã¯çµ¦æ°´ã•ã‚Œãªã„ 0mlçµ¦æ°´ã•ã‚Œã‚‹ 

ã“ã‚Œã‚‰ã‚’Property based testingã§ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†
fc.nat(10)ã‚’ä½¿ã£ã¦1-10ç§’ã¾ã§ã®ä»»æ„ã®ç§’æ•°ã®pourãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¦ç¢ºèªã—ã¦ã„ãã¾ã™
ã¾ãŸã€fc.nat(1000)ã§ç©ºã«ãªã£ãŸã‚‰0-1000ã¾ã§ã®ä»»æ„ã®mlã®æ°´ã‚’å……å¡«ã—ã¾ã—ã‚‡ã†

```JavaScript
import fc from 'fast-check'
import Goma1015 from '../../src/lib/index'

describe('Goma1015', () => {
  .
  .
  .
  it('can pour', () => {
    let g = new Goma1015()
    //check definition
    expect(g.pour).toBeDefined()
    expect(g.plugIn).toBeDefined()
    expect(g.plugOff).toBeDefined()

    //deault plugOff
    expect(() => g.pour(15)).toThrowError(/plug should be connected/)
    //pouring needs to be pot closed
    g.open()
    g.plugIn()
    expect(() => g.pour(15)).toThrowError(/is open/)
    g.close()

    //plugOff
    g.plugOff()
    expect(() => g.pour(15)).toThrowError(/plug should be connected/)
    g.plugIn()

    //negative sec
    expect(() => g.pour(-1)).toThrowError(/can't be poured with negative sec/)
    //can not pour water anymore if empty
    expect(g.pour(100)).toBe(0)

    //property based testing for pour
    g = new Goma1015()
    //fill to full
    let water = 1000
    g.plugIn()
    g.open()
    g.fill(water)
    g.close()
    let sec = 0
    fc.assert(
      fc.property(fc.nat(10), fc.nat(1000), (s, w) => {
        //refill if empty
        //* water is poured 10 ml/sec
        if (sec >= water / 10) {
          expect(g.pour(s)).toBe(0)
          sec = 0
          water = w
          g.open()
          g.fill(water)
          g.close()
          return
        }
        //not empty
        //s equals 0 pour should be 0
        expect(g.pour(s) == 0).toBe(s == 0)
        sec += s
      }),
    )
  })
})
```

#æœ€å¾Œã«
æ¬¡ã¯ã„ã‚ˆã„ã‚ˆ[æ²¸é¨°](https://qiita.com/freddiefujiwara/items/076cbe57cab936b54fc3)ã•ã›ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™
ã¾ãŸã€ã‚³ãƒ¼ãƒ‰ã«ã‚‚ã—é–“é•ã„ã‚ã‚Šã¾ã—ãŸã‚‰[Pull request](https://github.com/freddiefujiwara/goma-1015)ã¯å¤§æ­“è¿ã§ã™ã€‚
é•·ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€€æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
