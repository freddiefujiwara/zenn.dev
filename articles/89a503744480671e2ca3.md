---
title: "Flutterã‚¢ãƒ—ãƒªã‚’GitHub Actionsã‚’ä½¿ã£ã¦webã¨apkã‚’åŒæ™‚ã«buildã—å…¬é–‹ã™ã‚‹ã¾ã§"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Android","AndroidStudio","Flutter","PWA","GitHubActions"]
published: true
---
# ã¯ã˜ã‚ã«
ç§ã¯æ™®æ®µä¼‘ã¿ã®æ—¥ã®æœã‚’ä¸­å¿ƒã«ã€æ™®æ®µå®¶åº­å†…ã®ç”Ÿæ´»ã«ä½¿ã£ãŸã‚Šã€å­ä¾›ã¨éŠã¶ãŸã‚ã®ä¾¿åˆ©ãªã‚¢ãƒ—ãƒªãªã©ã‚’ä½œã£ã¦ã¾ã™ã€‚
å€‹äººé–‹ç™ºãªã®ã§ã€ã‚ã¾ã‚Šæ‰‹é–“ã‚’ã‹ã‘ãšã«ã‚µã‚¯ãƒƒã¨è‰²ã‚“ãªã‚‚ã®ã‚’ä½œã‚ŠãŸã„ã¨æ€ã£ã¦ã„ãŸã¨ãã«
[Flutter](https://flutter.dev/)ã«å‡ºä¼šã„ã¾ã—ãŸã€‚
Flutterã¯ã»ã¼ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚„ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ãƒ„ãƒ¼ãƒ«ã¨åŒã˜ãã‚‰ã„ã¨è¨€ã£ã¦ã„ã„ãã‚‰ã„
ã‚ã¾ã‚Šæ‰‹é–“ãŒã‹ã‹ã‚‰ãšãã‚Œãªã‚Šã®ã‚¢ãƒ—ãƒªã‚’ã‚µã‚¯ãƒƒã¨é–‹ç™ºã§ãã¾ã™ã€‚
ã¯ã˜ã‚ã¯ã€æ‰‹å…ƒã§buildã—ã€ã„ã¡ã„ã¡ã‚µãƒ¼ãƒã«deployã™ã‚‹ã¨ã„ã£ãŸä½œæ¥­ã‚’ã—ã¦ã„ã¾ã—ãŸãŒã€è²´é‡ãªåœŸæ—¥ã®æœã®æ™‚é–“
å°‘ã—ã§ã‚‚æ‰‹é–“ã‚’æ¸›ã‚‰ã—ãŸã„ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚
æ‰‹å…ƒã§ã¯ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ãƒ†ã‚¹ãƒˆã‚’èµ°ã‚‰ã›ã€ã‹ã‚“ãŸã‚“ã«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ç¢ºèªã™ã‚‹ã¨è¨€ã£ãŸä½œæ¥­ã ã‘ã«é›†ä¸­ã—ã€
buildã‚„deployã¯GitHub Actionsã«ä»»ã›ã‚ˆã†ã¨æ€ã„è‰²ã€…èª¿æŸ»ã‚’ã—ãŸçµæœã‚’ãƒ¡ãƒ¢ã—ã¦ã„ã¾ã™ã€‚

# flutter web ã‚’ä½¿ã£ã¦webã‚¢ãƒ—ãƒªã‚’ gh-pagesã«å…¬é–‹ã™ã‚‹
## å‰æ
ã“ã®è¨˜äº‹ã§ã¯å‰æã¨ã—ã¦ä¸‹è¨˜ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
- Flutterã§ã‚¢ãƒ—ãƒªé–‹ç™ºã‚’ã—ã¦ã„ã‚‹
- GitHubä¸Šã«ãƒ¬ãƒã‚¸ãƒˆãƒªãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹
- ãƒ¬ãƒã‚¸ãƒˆãƒªä¸Šã«gh-pagesã¨ã„ã†branchãŒä½œæˆã•ã‚Œã¦ã„ã‚‹

## gh-pagesã®è¨­å®š
ã¾ãšã¯webç‰ˆã‚’deployã™ã‚‹ãŸã‚ã®ä¸‹åœ°ã¨ã—ã¦gh-pagesã‚’è¨­å®šã—ã¾ã—ã‚‡ã†
https://github.com/[ã‚ãªãŸã®ãƒ¦ãƒ¼ã‚¶ID]/[å¯¾è±¡ã®ãƒ¬ãƒã‚¸ãƒˆãƒª]/settings
ã«è¡Œã gh-pagesã®è¨­å®šã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¾ã™
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1817/2e75e012-c143-215c-c577-d3e251290526.png)


## GitHub Actionsã®è¨­å®š
 /path/to/[flutterã‚¢ãƒ—ãƒªã®ãƒ«ãƒ¼ãƒˆ]/.github/workflows/flutter.yaml 
ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†

```yaml
name: Flutter CI
'on':
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2
      - name: Flutter setting
        uses: subosito/flutter-action@v1
        with:
          channel: beta
      - name: "Install and Build  ğŸ”§"
        run: |
          flutter config --enable-web
          flutter pub get
          flutter test
          flutter build web
      - name: "Deploy ğŸš€"
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          GITHUB_TOKEN: '${{ secrets.GITHUB_TOKEN }}'
          BRANCH: gh-pages
          FOLDER: build/web
```
ã“ã‚Œã‚’**main**ã«pushã—ã¾ã—ã‚‡ã†

## web appãŒdeployã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†
pushã™ã‚‹ã¨è‡ªå‹•çš„ã«GitHub Actions Flutter CIãŒèµ°ã‚‹ã¨æ€ã„ã¾ã™
ã“ã¡ã‚‰ãŒçµ‚ã‚ã£ãŸã‚‰(è‡ªåˆ†ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã®å ´åˆã¯3åˆ†ä½ã‹ã‹ã‚Šã¾ã™^^;)
https://[ã‚ãªãŸã®githubã‚«ã‚¦ãƒ³ãƒˆ].github.io/[ãƒ¬ãƒã‚¸ãƒˆãƒªå]/
ã«è¡Œã£ã¦ã‚ãªãŸã®Flutterã‚¢ãƒ—ãƒªãŒå‹•ãã‹ã©ã†ã‹ç¢ºèªã—ã¦ãã ã•ã„

# apkã‚’GitHub Actionsã‚’ä½¿ã£ã¦signã™ã‚‹
## ãªãœsignãŒå¿…è¦ã‹
è‡ªåˆ†ã®å ´åˆã“ã‚Œã‚’èª¿æŸ»ã—ãŸãã£ã‹ã‘ã¯ã€[firebase_auth](https://pub.dev/packages/firebase_auth)ã‚’ä½¿ã£ãŸå ´åˆã€
ã§ã¯keystoreã®SHA-1 fingerprintã‚’firebase consoleã«è¨­å®šã—ãªã„ã¨
[google_sign_in](https://pub.dev/packages/google_sign_in)ãŒAndroid appç‰ˆã§ã¯å‹•ã‹ãªã„ã¨ã†ç—‡çŠ¶ã«æ‚©ã¾ã•ã‚ŒãŸã“ã¨ã¨ã€
åŸºæœ¬çš„ã«ã¯buildã¯GitHub Actionsã‚’ä½¿ã£ã¦ã‚„ã‚ŠãŸã„ãªã¨æ€ã£ã¦ã„ãŸãŸãŸã‚ã€ã“ã‚Œã‚’åŒæ™‚ã«å‡ºæ¥ã‚‹æ–¹æ³•ãŒç„¡ã„ã‹èª¿æŸ»ã—ã¦ã„ã¾ã—ãŸã€‚
ã¾ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã‹ã‚‰ã€keystoreãƒ•ã‚¡ã‚¤ãƒ«ã‚„ç”Ÿã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’github repositryã«pushã™ã‚‹ã“ã¨ã¯æµçŸ³ã«å«Œã§ã™ã‚ˆã­ã€‚
ã‚‚ã—ã“ã‚Œã‚’ã‚„ã£ã¦ã—ã¾ã†ã¨æ‚ªæ„ã‚’æŒã£ãŸäººãŒãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€
Google Play ã«ã‚¢ãƒ—ãƒªã‚’ã‚ãªãŸã«ãªã‚Šã™ã¾ã—ã¦å…¬é–‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
ä»¥ä¸‹ã®ç« ã§ã¯[Signing Flutter Android apps for release in GitHub Actions](https://dev.to/cddelta/signing-flutter-android-apps-for-release-in-github-actions-2892)ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã
GitHub Actionsã‚’ä½¿ã£ã¦flutter build apkã‚’ä½¿ã£ã¦å®‰å…¨ã«Androidã‚’ãƒªãƒªãƒ¼ã‚¹ç½²åã‚’è¡Œã†æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚

## keystoreã‚’ä½œæˆã™ã‚‹
[Signing the app](https://flutter.dev/docs/deployment/android#signing-the-app) ã«ã‚ã‚‹æ–¹æ³•ã‚’ä½¿ã£ã¦
keystoreã‚’ä½œæˆã—ã¦ãã ã•ã„
ä¾‹ãˆã°Windowsã§ã‚ã‚Œã°

```bash
$ keytool -genkey -v -keystore c:\Users\USER_NAME\key.jks -storetype JKS -keyalg RSA -keysize 2048 -validity 10000 -alias [ALIAS]
```
ã“ã®ã‚ˆã†ã«ã—ã¦ä½œæˆã—ã¾ã™ã€‚
ã¾ãŸä½œæˆæ™‚ã«åˆ©ç”¨ã—ãŸ**KEY_STORE_PASSWORD**, **KEY_PASSWORD**, **ALIAS**ã¯å¿˜ã‚Œãªã„ã§è¦šãˆã‚‹ã‹ãƒ¡ãƒ¢ã—ã¦ãã ã•ã„

## SIGNING_KEYã‚’å–å¾—ã™ã‚‹
opensslã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ãˆã° **SIGNING_KEY**ã‚’å–å¾—ã§ãã¾ã™

```bash
$ openssl.exe base64 -A -in c:\Users\USER_NAME\key.jks
/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.....xxxxxxxxxxxxxx=
```
å‡ºåŠ›ã•ã‚ŒãŸãªãŒãƒ¼ã„æ–‡å­—åˆ—ã‚’ã‚³ãƒ”ãƒšã—ã¦ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã—ã‚‡ã†
## (option) SHA-1 fingerprintã‚’firebase consoleã®Androidã‚¢ãƒ—ãƒªã«è¨­å®šã—ã¾ã—ã‚‡ã†
è‡ªåˆ†ãŒã‚‚ã¨ã‚‚ã¨ãƒãƒã£ã¦ã„ãŸã®ã¯ã“ã“ã§ã€å…ˆç¨‹ã¤ãã£ãŸkeystoreã‚’ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦SHA-1 fingerprintã‚’å¾—ã¦
ãã‚Œã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã—ã‚‡ã†

```bash
$ keytool.exe  -list -v --alias [ALIAS] -keystore c:\Users\USER_NAME\key.jks
Enter keystore password:  [KEY_STORE_PASSWORD]
Alias name: [ALIAS]
Creation date: YYYY/MM/DD
Entry type: PrivateKeyEntry
Certificate chain length: 1
Certificate[1]:
Owner: C=US, O=Android, CN=Android Debug
Issuer: C=US, O=Android, CN=Android Debug
Serial number: 1
Valid from: Fri Sep 25 20:27:37 JST 2020 until: Sun Sep 18 20:27:37 JST 2050
Certificate fingerprints:
         MD5:  XX:XX:XX..
         SHA1: XX:XX:XX..
         SHA256: XX:XX:XX..
Signature algorithm name: SHA1withRSA
Subject Public Key Algorithm: 2048-bit RSA key
Version: 1
```
ä¸Šè¨˜ã«è¡¨ç¤ºã•ã‚Œã‚‹SHA1 XX:XX:XXã¨SHA256XX:XX:XXã‚’ã‚³ãƒ”ãƒ¼ã—ã¦
[Firebase console](https://console.firebase.google.com/)ã«è¡Œãè¨­å®šã—ã¾ã—ã‚‡ã†
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1817/52198311-d863-d042-cfd0-8981859a283e.png)


## æ‰‹å…ƒã§buildã™ã‚‹æº–å‚™ã‚’ã™ã‚‹
### key.propertiesã‚’ä½œæˆ
 /path/to/[flutterã‚¢ãƒ—ãƒªã®ãƒ«ãƒ¼ãƒˆ]/android/key.properties
ã‚’ä½œæˆã—ã¾ã™

```
storePassword=[å…ˆç¨‹ãƒ¡ãƒ¢ã£ãŸKEY_STORE_PASSWORD]
keyPassword=[å…ˆç¨‹ãƒ¡ãƒ¢ã£ãŸKEY_PASSWORD]
keyAlias=[å…ˆç¨‹ãƒ¡ãƒ¢ã£ãŸALIAS]
storeFile=[c:\Users\USER_NAME\key.jksã€€ãªã©]
```
### key.propertiesã‚’.gitignoreã«å¿˜ã‚Œãšã«å…¥ã‚Œã¦ãŠãã¾ã—ã‚‡ã†
key.propertiesã‚’å…¬é–‹ã—ã¦ã—ã¾ã£ãŸã‚‰å…ƒã‚‚å­ã‚‚ãªã„ã®ã§
ã¡ã‚ƒã‚“ã¨.gitignoreã«å…¥ã‚Œã¦ãŠãã¾ã—ã‚‡ã†

```bash
$ echo android/key.properties >> .gitignore
```
### build.gradleã®ç·¨é›†
 /path/to/[flutterã‚¢ãƒ—ãƒªã®ãƒ«ãƒ¼ãƒˆ]/android/app/build.gradle
ã‚’ç·¨é›†ã—ã¾ã™
ç·¨é›†ã™ã‚‹ç®‡æ‰€ã¯2ã¤
ã¾ãšã¯ key.propertiesãŒã‚ã£ãŸã‚‰
å…ˆç¨‹è¨­å®šã—ãŸ key.propertiesã‹ã‚‰**KEY_STORE_PASSWORD**, **KEY_PASSWORD**, **ALIAS**ã¨**KEY_PATH**ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™
GitHub Actionsä¸Šã§ã¯ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€ã®ã§elseã®ä¸­èº«ã¯GitHub Actionsç”¨ã§ã™

```gradle
def keystoreProperties = new Properties()
def keystorePropertiesFile = rootProject.file('key.properties')
if (keystorePropertiesFile.exists()) {
    keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
} else {
    keystoreProperties.setProperty('storePassword', System.getenv('KEY_STORE_PASSWORD'));
    keystoreProperties.setProperty('keyPassword', System.getenv('KEY_PASSWORD'));
    keystoreProperties.setProperty('keyAlias', System.getenv('ALIAS'));
    keystoreProperties.setProperty('storeFile', System.getenv('KEY_PATH'));
}
```
æ¬¡ã«signã§ãã‚‹ã‚ˆã†ã«buildTypesã®ä¸Šã«siningConfigsã‚’è¿½åŠ ã—ã€
æ›´ã«buildTypesã‚‚signingConfigs.releaseã«å¤‰ãˆã¾ã—ã‚‡ã†

```gradle   
signingConfigs {
        release {
            keyAlias keystoreProperties['keyAlias']
            keyPassword keystoreProperties['keyPassword']
            storeFile keystoreProperties['storeFile'] ? file(keystoreProperties['storeFile']) : null
            storePassword keystoreProperties['storePassword']
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
        }
    }
    /*
    buildTypes {
        release {
            // TODO: Add your own signing config for the release build.
            // Signing with the debug keys for now, so `flutter run --release` works.
            signingConfig signingConfigs.debug
        }
    }*/
```

##ã€€æ‰‹å…ƒã§buildã—ã¦ã¿ã¾ã—ã‚‡ã†

```bash
$ flutter build apk
You are building a fat APK that includes binaries for android-arm, android-arm64, android-x64.
If you are deploying the app to the Play Store, it's recommended to use app bundles or split the APK to reduce the APK size.
    To generate an app bundle, run:
        flutter build appbundle --target-platform android-arm,android-arm64,android-x64
        Learn more: https://developer.android.com/guide/app-bundle
    To split the APKs per ABI, run:
        flutter build apk --target-platform android-arm,android-arm64,android-x64 --split-per-abi
        Learn more: https://developer.android.com/studio/build/configure-apk-splits#configure-abi-split
Running Gradle task 'assembleRelease'...                           19.0s
âˆš Built build\app\outputs\flutter-apk\app-release.apk (7.6MB).
```
ã“ã®ã‚ˆã†ã«buildã§ããŸã‚‰æˆåŠŸã§ã™

## GitHubã®ãƒ¬ãƒã‚¸ãƒˆãƒªã®secretsã«ã“ã‚Œã‚‰ã‚’è¨­å®šã—ã¦ã„ãã¾ã™
https://github.com/[ã‚ãªãŸã®ãƒ¦ãƒ¼ã‚¶ID]/[å¯¾è±¡ã®ãƒ¬ãƒã‚¸ãƒˆãƒª]/settings/secrets
ã«è¡Œã£ã¦
å³ä¸Šã®**New secret**ã‚’æŠ¼ä¸‹ã—ã¦ãƒ¡ãƒ¢ã—ãŸ**KEY_STORE_PASSWORD**, **KEY_PASSWORD**, **ALIAS**ã¨**SIGNING_KEY**
ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1817/dc7bd69e-a582-ed7a-5ced-38ed024ddab3.png)
## .github/workflows/flutter.yamlã‚’ç·¨é›†
ã•ã‚ã€€å¾Œå°‘ã—ã§çµ‚ã‚ã‚Šã§ã™
 /path/to/[flutterã‚¢ãƒ—ãƒªã®ãƒ«ãƒ¼ãƒˆ]/.github/workflows/flutter.yaml 
ã‚’ä¸‹è¨˜ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã—ã‚‡ã†

```yaml
name: Flutter CI
'on':
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2
      - name: Flutter setting
        uses: subosito/flutter-action@v1
        with:
          channel: beta
      - name: "Install and Build  ğŸ”§"
        run: |
          echo $SIGNING_KEY | base64 -d > android/app/key.jks
          flutter config --enable-web
          flutter pub get
          flutter test
          flutter build apk
          flutter build web
          mkdir build/web/apks
          cp build/app/outputs/flutter-apk/*.apk build/web/apks/
        env:
          SIGNING_KEY: ${{ secrets.SIGNING_KEY }}
          KEY_STORE_PASSWORD: ${{ secrets.KEY_STORE_PASSWORD }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
          ALIAS: ${{ secrets.ALIAS }}
          KEY_PATH: key.jks
      - name: "Deploy apk ğŸš€"
        uses: actions/upload-artifact@v1
        with:
          name: release-apk
          path: build/app/outputs/flutter-apk/app-release.apk
      - name: "Deploy to gh-pages ğŸš€"
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          GITHUB_TOKEN: '${{ secrets.GITHUB_TOKEN }}'
          BRANCH: gh-pages
          FOLDER: build/web
```
ã“ã‚Œã‚’ã¾ãŸ**main**ã«pushã—ã¾ã—ã‚‡ã†
æˆåŠŸã™ã‚‹ã¨
https://[ã‚ãªãŸã®githubã‚«ã‚¦ãƒ³ãƒˆ].github.io/[ãƒ¬ãƒã‚¸ãƒˆãƒªå]/apks/app-release.apk ã«ã‚¢ãƒ—ãƒªãŒé…ç½®ã•ã‚Œã¾ã™

# ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã¯ã“ã¡ã‚‰
![Demo](https://freddiefujiwara.com/Osaifu-Minimalist/images/ezgif.com-gif-maker.gif)

[Demo App](https://github.com/freddiefujiwara/jpy_minimize_your_change)


# ãŠã‚ã‚Šã«
ã¡ã‚‡ã£ã¨é•·ã‹ã£ãŸã§ã™ãŒã€ãªã‚“ã¨ã‹ã“ã‚Œã§
web appã¨Android apk(é‡è‰¯ã‚¢ãƒ—ãƒª)ã‚’ gh-pagesä¸Šã«åŒæ™‚å…¬é–‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã™ã”ãæ¥µç«¯ãªè©±ã€Android StudioãŒãªãã¦ã‚‚ GitHubä¸Šã§ã‹ã‚“ãŸã‚“ãªbug fixã¨ã‹ç·¨é›†ã—ã¦ã—ã¾ãˆã°
è‡ªå‹•çš„ã«GitHub ActionsãŒèµ°ã‚Šã€ãƒ“ãƒ«ãƒ‰ã•ã‚Œã€Deployã¾ã§ã§ãã¾ã™
