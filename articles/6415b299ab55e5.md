---
title: "Vue 3で“英語タイピング体験”を磨き込む：小さな工夫が大きなUXになる話"
emoji: "💡"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["vue", "typescript", "vite", "frontend"]
published: true
---

## 導入
- **なぜこれを作ったのか（背景・課題）**  
  「スワイプ入力（Swipe Typing）」って知っていますか？キーボードの上を指でなぞるようにして英語を打つ方法なのですが、それを練習したくアプリを作ってみました。

- **使用した技術スタックの概要**  
  Vue 3（Composition API / `<script setup>`）を中心に、Vite + Vitest で開発・テストを整備した構成です。GitHub Pages 配信を意識した `base` 設定と、`jsdom` + `v8` カバレッジでのテスト設計が特徴です。

---

## 🚀 今回の技術的なこだわりポイント

### 1. Composition APIで「状態と時間」を一貫管理
`ref`・`computed`・`watch`・ライフサイクルフックを活用して、**入力開始→タイマー開始→文の完了→次の文へ**という流れを単一の状態遷移として設計しています。タイマーは入力開始時のみ起動し、最後の文完了時に停止するため、余計な稼働を避けています。

```js
const startTimer = () => {
  if (!timerInterval.value) {
    timerInterval.value = setInterval(() => {
      elapsedTime.value += 0.1;
    }, 100);
  }
};

const handleInput = () => {
  if (userInput.value.length > 0) {
    startTimer();
  }
  if (isSentenceComplete(userInput.value, currentSentence.value)) {
    if (currentIndex.value === sentences.value.length - 1) {
      stopTimer();
    }
    setTimeout(() => {
      currentIndex.value++;
      userInput.value = '';
    }, 100);
  }
};
```

**ポイント**  
- `setTimeout` でほんの短い“視覚的余韻”を入れ、正解体験を壊さない。  
- `watch(loading)` で読み込み完了後に自動フォーカスすることで、余計な操作を排除。

---

### 2. 文章取得〜整形のパイプラインを明確化
文章はgroq->GAS->このアプリという流れで CSV 形式で取得し、**parse → clean → normalize** を明確な手順として `utils` に切り出しています。これにより、入力比較に必要な「半角英字＋スペースのみ」という厳密な前提を実装で保証できます。

```js
return csvText
  .split(/[\n,]/)
  .map(item => item.trim())
  .map(cleanText)
  .map(text => text.replace(/\s+/g, ' ').trim())
  .filter(text => text.length > 0);
```

**ポイント**  
- CSV が “厳密形式ではない” ことを認識しつつ、実運用を意識した割り切り設計。  
- 文のシャッフルと 10 件への絞り込みで、**毎回違う体験**にする工夫も入っています。

---

### 3. 「1文字ずつの可視化」と判定ロジックの分離
入力の正誤を `getCharClass` に委譲し、UI 側は **1文字ずつレンダリングしてクラスを付けるだけ**にしています。これにより UI と判定ロジックの責務が分離され、テストも容易です。

```js
export function getCharClass(index, userInput, targetSentence) {
  if (index >= targetSentence.length) return '';

  if (index < userInput.length) {
    return userInput[index].toLowerCase() === targetSentence[index].toLowerCase()
      ? 'char-correct'
      : 'char-incorrect';
  }
  return 'char-pending';
}
```

**ポイント**  
- 判定は **大文字/小文字を同一視**し、学習体験の摩擦を減らす。  
- `hidden-input` を使って UI を崩さずに入力を集中させる設計が秀逸。

---

### 4. Vite + Vitest でDXを底上げ
`vite.config.js` で `base: '/swty/'` を設定し、GitHub Pages 配信を前提とした構成にしています。テストは `jsdom` 環境で回し、`v8` カバレッジを利用できるのも、運用を見据えた設計です。

```js
export default defineConfig({
  base: '/swty/',
  plugins: [vue()],
  test: {
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
    },
  },
});
```

---

## 苦労した点と乗り越え方
- **「入力の気持ちよさ」を損なわないタイミング調整**  
  正解直後に即次へ進むと体験が雑になるため、`setTimeout(100ms)` の“ちょうどいい余韻”を入れています。

- **API から取得する CSV の品質差に耐える**  
  正規表現での簡易パース＋クレンジングを挟むことで、外部依存を最小限にしつつ安定性を確保しました。

---

## まとめ
- Composition API を活かし、**状態・タイマー・UI 表現を一貫した設計にまとめる**ことで、小さなアプリでも拡張しやすい構造になりました。
- **“入力感”にこだわる UX 設計**（自動フォーカス・視覚余韻・文字単位の反応）によって、練習アプリとしての魅力が高まりました。
- 今後は **文の難易度分類やスコアリング**を導入して、さらにゲーミフィケーションを強化したいです。

---

## リンク
- GitHub: https://github.com/freddiefujiwara/swty
- Demo: http://freddiefujiwara.com/swty/
