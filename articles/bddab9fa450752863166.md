---
title: "Property based testing ã‚’è©¦ã—ã¦ã¿ã‚ˆã†"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["fast-check","property-based-testing"]
published: true
---

#Property based testingã¨ã¯
æ­´å²çš„ãªèƒŒæ™¯ã¨ã—ã¦2000å¹´ã«[John Hughes](https://en.wikipedia.org/wiki/John_Hughes_(computer_scientist))ã¨[Koen Clasessen](http://www.cse.chalmers.se/~koen/)ã«ã‚ˆã£ã¦
é–‹ç™ºã•ã‚ŒãŸ[QuickCheck](https://hackage.haskell.org/package/QuickCheck)ãŒProperty based testingã¨ã—ã¦[Haskell](https://www.haskell.org/)ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã«å®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚
QuickCheckã¯ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆç‰¹å®šã®å…¥åŠ›ãŒä¸ãˆã‚‰ã‚Œã‚‹ã¨å‡ºåŠ›ã¨ã—ã¦æœŸå¾…ã•ã‚Œã‚‹ç‰¹æ€§ï¼‰
ã‚’ä¸ãˆã‚‹ã“ã¨ã§ã€
ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã—ã¦ã€å¤±æ•—ã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹Haskellã§å®Ÿè£…ã•ã‚ŒãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ 
ãã‚Œã«ã‚ˆã£ã¦ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚·ã‚¹ãƒ†ãƒ ãŒãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¾“ã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ 
QuickCheckã¯å˜ä½“ãƒ†ã‚¹ãƒˆã ã‘ã§ã¯ãªãã€çµ±åˆãƒ†ã‚¹ãƒˆã‚„ã‚µãƒ³ãƒ—ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆç­‰å¹…åºƒãä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•ã¯Property based testingã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
2020å¹´ç¾åœ¨ã¯ã€Haskellã®QuickCheckã ã‘ã§ãªãã€æ§˜ã€…ãªè¨€èªã§Property based testingã‚’å®Ÿè£…ã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒé–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®è¨˜äº‹ã§ã¯[fast-check](https://github.com/dubzzz/fast-check)ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™

#fast-check
fast-checkã¯JavaSciptç”¨ã®Property based testing framework
ã§TypeScriptã§å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™

#ä»Šå›ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ä»•æ§˜
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ ã‚’è€ƒãˆã¾ã™ã€‚
ä»•æ§˜ã¨ã—ã¦ã¯ä¸‹è¨˜3ã¤ã§ã™

- spec 01ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™ã€‚
- spec 02ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æœ€å°8æ–‡å­—ã€æœ€å¤§20æ–‡å­—ã§ã™
- spec 03ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã¯ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã€æ•°å­—ã€å°åˆ·å¯èƒ½ãªè¨˜å·ã‚’æ··åœ¨ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#æº–å‚™
[ã“ã¡ã‚‰](https://github.com/freddiefujiwara/fast-check-password-validator-example)ã«ä»Šå›å®Ÿè£…ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’é…ç½®ã—ã¦ã¿ã¾ã—ãŸã€‚
Nodejsã®ç’°å¢ƒãŒæ‰‹å…ƒã«ã‚ã‚Œã°ã€è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```bash
git clone https://github.com/freddiefujiwara/fast-check-password-validator-example.git
cd fast-check-password-validator-example
npm i
npm test
```

#Property based testingå®Ÿè·µ
## spec 01ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™ã€‚
https://github.com/freddiefujiwara/fast-check-password-validator-example/tree/feature/stec-01

ãã‚Œã§ã¯ã€ã“ã‚Œã‚’ç¢ºèªã—ã¦ã¿ã¾ã™
å¿…é ˆã¤ã¾ã‚Šnull,undefinedã‚„ç©ºæ–‡å­—ã§ã¯ãªã„ã¨ã„ã†ã“ã¨ã‚’ç¢ºèªã—ã¾ã™

```JavaScript
import fc from 'fast-check';
import validate from '../src/password_validator';

describe('spec 01 : the passwords is required', () => {
    test('Passwords is required', () => {
        expect(validate(null)).toBe(false);
        expect(validate(undefined)).toBe(false);
        expect(validate("")).toBe(false);
    });
});
```
ãƒ†ã‚¹ãƒˆã‚’èµ°ã‚‰ã›ã¾ã—ã‚‡ã†

```
$ npm test
```
ãŠãã‚‰ãå¤±æ•—ã™ã‚‹ã¨æ€ã„ã¾ã™ã€€
ãã‚Œã§ã¯ã€å¤±æ•—ã—ãªã„ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ã‚‡ã†

```JavaScript
export default function validate(password:string) :boolean {
    return !!password;
};
```

## spec 02ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æœ€å°8æ–‡å­—ã€æœ€å¤§20æ–‡å­—ã§ã™
https://github.com/freddiefujiwara/fast-check-password-validator-example/tree/feature/spec-02
ã“ã“ã§fast-checkã®æ©Ÿèƒ½ã‚’ã¤ã‹ã£ã¦ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†
æœ€å°8æ–‡å­— ã¤ã¾ã‚Šä»»æ„ã®é•·ã•0-7ã®æ–‡å­—åˆ—fc.string(0,7)ã¯rejectã•ã‚Œã¾ã™
ã¾ãŸæœ€å¤§20æ–‡å­—ã¤ã¾ã‚Šä»»æ„ã®é•·ã•21-100ã®æ–‡å­—åˆ—fc.string(21,100)ã¯rejectã•ã‚Œã¾ã™

```JavaScript
import fc from 'fast-check';
.
.
.
describe('spec 02 : the password should have a minimum of 8 characters and maximum of 20 characters', () => {
    test('Passwords which length is less than 8 should be rejected', () => {
        fc.assert(
            fc.property(fc.string(0,7),(password:string) => {
                ///   console.log(password);
                expect(validate(password)).toBe(false);
            })
        );
    });
    test('Passwords which length is more than 20 should be rejected', () => {
        fc.assert(
            fc.property(fc.string(21,100),(password:string) => {
                ///console.log(password);
                expect(validate(password)).toBe(false);
            })
        );
    });
});
```
ã¡ãªã¿ã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã¯ã“ã‚“ãªæ–‡å­—åˆ—ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™
æ–‡å­—åˆ—0-7ã¯

```
    Z"g?$]+                                                                                                                             
    [>ZH                                                                                                                                
    z@i0]1*                                                                                                                             
    zPq                                                                                                                                 
    zr                                                                                                                                  
    zt#                                                                                                                                 
    z V,                                                                                                                                
    z$w`[                                                                                                                               
    ZWCa2!                                                                                                                              
    _zW"z% 
```
æ–‡å­—åˆ—21-100ã¯

```
   =Oheb?Lli%`~z;]bVG>x+U@!EiEQ8==}eWZnV"Z#`^f                                                                                         
     g";$#Q$~""!%cp' #w$%$$__?X!_#*<Ve@0  &UW&e$ h&&\&2 &${Nf}%$&%Zh !!fJ::S#$Wi!$                                                      
    e|<pc~zRgglJzPOrMe3alw$26^n$'*]Y.XC0jfEt_"R*(lBE^DrWOe'5!30d_MuwHF9.                                                                
    W!?"F- 53q"%.&%6gG("##                                                                                                              
    $F"Z%f:sXA)$)!&Rm'{$%%#D D H!}k+$2%q!w$6*&!!7% %%:#!p&&&&*!E& @;4|+ $@! "+> f#]#<_i6" l)5$"#=!&$                                    
    $, !. #b!$!h#!B& "#!!^                                                                                                              
    UUC^&?ZjM{<fKqVVsx'/Zfr&eeN67&NX=%i XKo_EnNiH-:e*}gvy`P~[&UAmYjMA9BKSvkz(91nKmKNnV                                                  
    ~v+M~Sq"I5?:!~$BJhL+`:9|%! hPx"j2#SIPbF\ ~/1&W&#9~I4+,Vx2  
```
ã“ã‚Œã‚‚ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã‚’å¤‰æ›´ã—ã¾ã—ã‚‡ã†

```JavaScript
export default function validate(password:string) :boolean {
    return !!password &&
        password.length >= 8 && 
        password.length <= 20;
};
```

##spec 03ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ã¯ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã€æ•°å­—ã€å°åˆ·å¯èƒ½ãªè¨˜å·ã‚’æ··åœ¨ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
https://github.com/freddiefujiwara/fast-check-password-validator-example/tree/feature/spec-03
ã¤ã¾ã‚Šã€ä»»æ„ã®8-20æ–‡å­—ã®é•·ã•ã®
- ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®ã¿ã®æ–‡å­—åˆ—alphabetStrings(8,20)
- æ•°å­—ã®ã¿ã®æ–‡å­—åˆ—numberStrings(8,20)
- å°å­—å¯èƒ½ãªè¨˜å·ã®ã¿ã®æ–‡å­—åˆ—symbolStrings(8,20)
ã¯ãã‚Œãã‚Œrejectã•ã‚Œã¾ã™

```JavaScript
import fc from 'fast-check';
import validate from '../src/password_validator';
const char = (charCodeFrom:integer,charCodeTo:integer) => fc.integer(charCodeFrom, charCodeTo).map(String.fromCharCode);
const filteredStrings = (min:integer,max:integer,filter:RegExp) => {
    return fc.array(char(33, //'!'
                         126 //'~'
                        ).filter(c => filter.test(c)),min,max).map(arr => arr.join(''));
}
const numberStrings = (min:integer,max:integer) => filteredStrings(8,20,/^[0-9]$/);
const alphabetStrings = (min:integer,max:integer) => filteredStrings(8,20,/^[a-zA-Z]$/);
const symbolStrings = (min:integer,max:integer) => filteredStrings(8,20,/^[^a-zA-Z0-9]$/);
const properString = (min:integer,max:integer) => { 
    return filteredStrings(8,20,/^[a-zA-Z0-9!"#$%&'()*+,.\-\/:;<=>?@\[\\\]^_`{|}~]$/).filter( s => {
        return !/^[0-9]{8,20}$/.test(s) && 
            !/^[a-zA-Z]{8,20}$/.test(s) && 
            !/^[!"#$%&'()*+,.\-\/:;<=>?@\[\\\]^_`{|}~]{8,20}$/.test(s);
    });
}

.
.
.
describe('spec 03 : the password should be mixed alphabets , numbers and printable symbols', () => {
    test('Passwords only consisting numbers{8,20} should be rejected', () => {
        fc.assert(
            fc.property(numberStrings(8,20),(password:string) => {
                //  console.log(password);
                expect(validate(password)).toBe(false);
            })
        );
    });
    test('Passwords only consisting alphabets{8,20} should be rejected', () => {
        fc.assert(
            fc.property(alphabetStrings(8,20),(password:string) => {
                //  console.log(password);
                expect(validate(password)).toBe(false);
            })
        );
    });
    test('Passwords only consisting printable symbols{8,20} should be rejected', () => {
        fc.assert(
            fc.property(symbolStrings(8,20),(password:string) => {
                //     console.log(password);
                expect(validate(password)).toBe(false);
            })
        );
    });
});
```
ã¡ãªã¿ã«æ•°å­—ã®ã¿

```                                                                                                                            
    844237099137                                                                                                                        
    8053131857684                                                                                                                       
    68226557255                                                                                                                         
    55342199                                                                                                                            
    1969391288752055422                                                                                                                 
    8401887422                                                                                                                          
    511561284786406745                                                                                                                  
    51687989036   
```
ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®ã¿

```                                                                                                                                  
    jOjRdsCB                                                                                                                            
    pSUHGdJUxoGsr                                                                                                                       
    JOkyMdpcbDKgJkeF                                                                                                                    
    otweSWNtPxe                                                                                                                         
    MSHBQjRoAAbBo                                                                                                                       
    OCCiomgCEpRYHRE                                                                                                                     
    NCySFCegBpJxAtXI                                                                                                                    
    iJBwrGjKIdT  
```
å°å­—å¯èƒ½ãªè¨˜å·ã®ã¿

```                                                                                                                             
    ]$%!!!'<'&%"!#                                                                                                                      
    #'$%$!"'#~!#                                                                                                                        
    &]##%+&"                                                                                                                            
    \]`\%[^'>}|&?~!                                                                                                                     
    <;\^.|(;@>*?)                                                                                                                       
    #"#<'/$"                                                                                                                            
    '{$:+|.(``\*/$.^ 
```

ã“ã‚ŒãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã‚’å¤‰æ›´ã—ã¾ã—ã‚‡ã†

```JavaScript
export default function validate(password:string) :boolean {
    return !!password &&
        password.length >= 8 && 
        password.length <= 20 && 
        !/^[0-9]{8,20}$/.test(password) && 
        !/^[a-zA-Z]{8,20}$/.test(password) && 
        !/^[!"#$%&'()*+,.\-\/:;<=>?@\[\\\]^_`{|}~]{8,20}$/.test(password);
};
```

##æœ€å¾Œã«æ­£å¸¸ç³»ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†

```JavaScript
import fc from 'fast-check';
.
.
.
describe('Positibe test', () => {
    test('Passwords only consisting proper characters{8,20} should be accepted', () => {
        fc.assert(
            fc.property(properString(8,20),(password:string) => {
                //   console.log(password);
                expect(validate(password)).toBe(true);
            })
        );
    });
});
```
ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã¿ã¦ã¿ã‚‹ã¨

```                                                                                                                                
    $!!9&CpJ"{                                                                                                                          
    %t$\x##AL                                                                                                                           
    !-${"$'rOMF!h/#'!'.)                                                                                                                
    ##ed;4NY4'#                                                                                                                         
    DuXy(4[>k^n`bdzFcQJ\                                                                                                                
    b[k!VT+Q;`{[&                                                                                                                       
    ,YNwD$YNc1T7\I7$ju                                                                                                                  
    m"&IH#&c.W- 
```
ã‚ã‚Œãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã­
ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«å®Ÿè£…ã‚’å¤‰æ›´ã—ã¾ã™

```JavaScript
export default function validate(password:string) :boolean {
    return !!password &&
        password.length >= 8 && 
        password.length <= 20 && 
        !/^[0-9]{8,20}$/.test(password) && 
        !/^[a-zA-Z]{8,20}$/.test(password) && 
        !/^[!"#$%&'()*+,.\-\/:;<=>?@\[\\\]^_`{|}~]{8,20}$/.test(password) &&
        /^[0-9a-zA-Z!"#$%&'()*+,.\-\/:;<=>?@\[\\\]^_`{|}~]{8,20}$/.test(password);
};
```
å…¨éƒ¨ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚Šã¾ã—ãŸã­ã€€ã‚ã§ãŸã—ã‚ã§ãŸã—

```bash
$ npm test                                                                           
                                                                                                                                        
> fast-check-password-validator-example@1.0.0 test /home/fumikazu/fast-check-password-validator-example                                 
> jest                                                                                                                                  
                                                                                                                                        
 PASS  __tests__/password_validator.spec.ts (6.964s)
  spec 01 : the passwords is required
    âœ“ Passwords is required (9ms)
  spec 02 : the password should have a minimum of 8 characters and maximum of 20 characters
    âœ“ Passwords which length is less than 8 should be rejected (640ms)
    âœ“ Passwords which length is more than 20 should be rejected (1053ms)
  spec 03 : the password should be mixed alphabets , numbers and printable symbols
    âœ“ Passwords only consisting numbers{8,20} should be rejected (1897ms)
    âœ“ Passwords only consisting alphabets{8,20} should be rejected (821ms)
    âœ“ Passwords only consisting printable symbols{8,20} should be rejected (877ms)
  Positive test
    âœ“ Passwords only consisting proper characters{8,20} should be accepted (701ms)

Test Suites: 1 passed, 1 total
Tests:       7 passed, 7 total
Snapshots:   0 total
Time:        7.969s, estimated 8s                                                                                                       
Ran all test suites.                                 
```
#æœ€å¾Œã«
Property based testingã¯å¾“æ¥ã®ãƒ†ã‚¹ãƒˆã‚’å®Œå…¨ã«ç½®ãæ›ãˆã‚‹ã‚‚ã®ã§ã¯ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ ã‚µãƒ³ãƒ—ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã¨æ¯”è¼ƒã—ã¦åºƒã„ç¯„å›²ã®å…¥åŠ›ã‚’ã‚«ãƒãƒ¼ã—ã€æ½œåœ¨çš„ãªå•é¡Œã‚’ç™ºè¦‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã–ã£ã¨fast-checkã‚’ä½¿ã£ã¦Property based testingã‚’ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸãŒã€ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ
ã¾ãŸä»Šå›ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ¼ãƒ™ãƒ¼ã‚¹ä»¥å¤–ã«ã‚‚fast-checkã¯çŠ¶æ…‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã‚¦ã‚©ãƒ¼ã‚¯ã•ã›ã¦å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã‚‚å®Ÿè£…ã•ã‚Œã¦ã‚‹ã¿ãŸã„ã§ã™ã­
https://github.com/dubzzz/fast-check/tree/master/example/004-stateMachine/musicPlayer

ã¾ãŸã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã«ã‚‚ã—é–“é•ã„ã‚ã‚Šã¾ã—ãŸã‚‰Pull requestã¯å¤§æ­“è¿ã§ã™ã€‚
é•·ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€€æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
